(function(){function n(e,t,n){for(property in t)e[property]=t[property];for(property in n)e[property]=n[property];return e}var e=this;var t;if(typeof exports!=="undefined")t=window.Oneline||{};else t=e.Oneline=window.Oneline||{};min=Math.min,max=Math.max,pow=Math.pow,sqrt=Math.sqrt,log=Math.log,floor=Math.floor;slice=Array.slice,splice=Array.splice,every=Array.every;websocket={};navigator=window.navigator?window.navigator:[];t.socket=t.socket||[];t.settings=t.settings||{};t.freq=t.freq=t.freq||1e3;t.loaded=0;t.setup=function(e){t.settings=e;t.socket=window.WebSocket?new window.WebSocket(e.server):MozWebSocket(e.server);t.freq=typeof e.freq!=="undefined"?e.freq:t.freq;t.socket.onopen=function(){t.loaded=1};t.socket.onmessage=function(e){console.log(JSON.parse(e.data))}};t.agent=function(e){};t.nodes=function(e){};t.value=function(e,t){return{op:e,value:t}};t.geolocation=function(e){t.geolocation.options=e;return{run:function(e){this.m={};this.state=0;this.every=O.geolocation.options.every;this.range=O.geolocation.options.range;var t=this;navigator.geolocation.getCurrentPosition(function(e){t.m.lat=e.coords.longitude;t.m.lng=e.coords.latitude;t.m.range=O.geolocation.options.range;t.state=1})}}};t.event=function(e){t.event.options=e;return{run:function(e){this.m={};this.m.event=t.event.options;this.state=1}}};t.pipeline=function(e,r,i){O.objects=r;O.callback=i;return{stop:function(){return O.signalStop=1},run:function(){O.t=setInterval(function(){if(t.running)return;if(!t.loaded)return O.connector.connect();if(t.signalStop||O.socket.readyState===2||O.socket.readyState===3){return O.connector.disconnect()}O.running=1;var e={},r=0,i={},s=0,o,u=0;for(var u in O.objects){O.objects[parseInt(u)].run(e);O.oot=setInterval(function(){if(r!==0&&O.objects[r-1].state!==1)return;if(typeof O.objects[r]!=="object")return;if(O.objects[r].state===1){e=n(e,O.objects[r].m);r++;clearInterval(O.oot)}},1)}O.ooot=setInterval(function(){if(r===O.objects.length){i.packet=e;o=(new Date).getTime();i.packet.timestamp=o;i.uuid=O.uuid();O.socket.send(JSON.stringify(i));if(typeof O.callback==="function")O.callback(i);O.running=0;clearInterval(O.ooot)}},1)},O.freq)}}};t.connector={connect:function(){if(O.socket.readyState===0)return;return O.setup(O.settings)},disconnect:function(){O.loaded=0;if(O.socket.readyState===3)return;return O.socket.close()}};t.uuid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)};window.O=t}).call(this)